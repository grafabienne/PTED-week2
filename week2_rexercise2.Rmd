---
title: "Exercise 2"
output: html_document
date: '2022-04-29'
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Task 1: Import Data
```{r}
## Load the necessary libraries ################################################

library(readr)        # to import tabular data (e.g. csv)
library(dplyr)        # to manipulate (tabular) data
library(ggplot2)      # to visualize data
library(sf)           # to handle spatial vector data
library(terra)        # To handle raster data
library(lubridate)    # To handle dates and times

## Import the downloaded csv ##################################################

wildschwein_BE <- read_delim("wildschwein_BE_2056.csv",",")

wildschwein_BE <- st_as_sf(wildschwein_BE, coords = c("E", "N"), crs = 2056, remove = FALSE)
```

Task 2: Getting an overview
```{r}
wildschwein_BE

wildschwein_BE%>%
  group_by(TierID)

wildschwein_BE$timelag<-as.integer(difftime(lead(wildschwein_BE$DatetimeUTC),wildschwein_BE$DatetimeUTC, units = "secs"))

```
Graphical overview
```{r}
ggplot(wildschwein_BE, aes(DatetimeUTC,TierID))+
  geom_point()+
  labs(title = "Tracking Period",
       x="Date"
       )
```

Overall three individuals were tracked concurrently over different time spans from august 2014 until July 2015. Animal 016A and 018A were tracked for a shorter time period than animal 002A.

```{r}
ggplot(wildschwein_BE,aes(timelag))+
  geom_histogram(binwidth = 5)+
  xlim(c(700,12000))+
  ylim(c(0,5000))+
  labs(x= "timelag [s]",
       title= "Time interval of measurements")

ggplot(wildschwein_BE, aes(timelag, colour= TierID))+
  geom_freqpoly()+
  xlim(c(800, 1000))+
  labs(x="timelag  [s]",
       title= "Distribution of time intervals")

```

The histogram shows that most of the time intervals are between 800 and 1000s and only few are greater than 1000. The second Graph shows the distribuiton of the "timelag" for every animal (Tier ID)

Task 3: Deriving movement parameters I: Speed
```{r}

wildschwein_BE$steplength<-sqrt((wildschwein_BE$E-lead(wildschwein_BE$E,1))^2+(wildschwein_BE$N-lead(wildschwein_BE$N,1))^2)

wildschwein_BE$speed<-wildschwein_BE$steplength/wildschwein_BE$timelag
str(wildschwein_BE)
```
Speed unit is m/s, because the coordinates are in meters and the timelag is in seconds. Depending on the purpose it could make sense to calculate m/min or km/h.

Task 4: Cross-scale movement analysis
```{r}
caro <- read_delim("caro60.csv",",")
caro <- st_as_sf(caro, coords = c("E", "N"), crs = 2056, remove = FALSE)
str(caro)
```
Reduction of granularity
```{r}
caro_3<-slice(caro,seq(from= 1, to= 200, by =3))
caro_6<-slice(caro,seq(from= 1, to= 200, by =6))
caro_9<-slice(caro,seq(from= 1, to= 200, by =9))
```
Caluclation of timelag, steplength and speed
```{r}
##caro
caro$timelag<-as.integer(difftime(lead(caro$DatetimeUTC),caro$DatetimeUTC, units = "secs"))

caro$steplength<-sqrt((caro$E-lead(caro$E,1))^2+(caro$N-lead(caro$N,1))^2)

caro$speed<-caro$steplength/caro$timelag

##caro_3
caro_3$timelag<-as.integer(difftime(lead(caro_3$DatetimeUTC),caro_3$DatetimeUTC, units = "secs"))

caro_3$steplength<-sqrt((caro_3$E-lead(caro_3$E,1))^2+(caro_3$N-lead(caro_3$N,1))^2)

caro_3$speed<-caro_3$steplength/caro_3$timelag

##caro_6
caro_6$timelag<-as.integer(difftime(lead(caro_6$DatetimeUTC),caro_6$DatetimeUTC, units = "secs"))

caro_6$steplength<-sqrt((caro_6$E-lead(caro_6$E,1))^2+(caro_6$N-lead(caro_6$N,1))^2)

caro_6$speed<-caro_6$steplength/caro_6$timelag

##caro_9
caro_9$timelag<-as.integer(difftime(lead(caro_9$DatetimeUTC),caro_9$DatetimeUTC, units = "secs"))

caro_9$steplength<-sqrt((caro_9$E-lead(caro_9$E,1))^2+(caro_9$N-lead(caro_9$N,1))^2)

caro_9$speed<-caro_9$steplength/caro_9$timelag
```
Visual interpretation
```{r}
caro$Interval<-"1min"
caro_3$Interval<-"3min"
caro_6$Interval<-"6min"
caro_9$Interval<-"9min"

allcaro<-rbind.data.frame(caro,caro_3,caro_6,caro_9)%>%
  group_by(Interval)

ggplot(allcaro, aes(DatetimeUTC,speed, col= Interval))+
  geom_line()+
  labs(title= "Speed at different sampling intervals",
       x= "Time [h]",
       y= "Speed [m/s]",
  )
                
ggplot(allcaro, aes(E,N,colour = Interval))+
  geom_sf()+
  geom_path()+
  coord_sf(datum =2056)+
  labs(title = "Trajectories of Caro in different sampling intervals")

```
The lineplot shows, that with lower granularity more information gets lost. In this example, the speed peaks at 9:10 decrease drastically. Also the speed variations are not represented well in the case of 6 and 9 min sampling intervals.
The second plot shows also, that some information gets lost. The hot spots are represented well even with the low granularity but some other parts of the route are lost.
